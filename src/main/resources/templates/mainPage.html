<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<link rel="icon" th:href="@{/favicon.ico}"/>
<head>
    <title>Catmash</title>
    <div th:replace="fragments/head.html :: headerCSSJS"></div>

</head>
<body>

<div th:replace="fragments/bodyContent.html :: navbar"></div>

<div th:with="someVariable=${'Имя будет взято из названия файла, например для файла &quot;Барсик.jpg&quot; будет взято имя &quot;Барсик&quot; (нужно добавить минимум ' + parameters.picturesMinCount + ' файлов, их количество должно быть четным).'}"></div>

<div class="container top horizontal-center">

    <div class="card default-indentation">
        <h3>Опросы:</h3>
        <ul id="mashes-list" class="list-group">
            <th:block th:each="mash : ${mashs}">
                <a th:href="'mash/' + ${mash.name}"
                   class="list-group-item list-group-item-action d-flex justify-content-between"
                   th:classappend="${notVotedMashes != null && !notVotedMashes.contains(mash)} ? 'list-group-item-success'"
                   th:inline="text" th:id="${'mash_' + mash.id}">
                    [[${mash.name}]]
                    <div th:if="${user?.containsRole('ADMIN')}"><span th:id="${mash.id}" class="removeMash"
                                                                      style="cursor: pointer;">X</span></div>
                </a>
            </th:block>
        </ul>
    </div>

    <div class="card default-indentation">
        <th:block th:if="${@environment.getProperty('registration.enable')}">
            <h3 sec:authorize="isAnonymous()">Вы сможете добавить свой опрос после регистрации</h3>
        </th:block>
        <h3 sec:authorize="isAuthenticated()">Добавить свой опрос: </h3>
        <span th:if="${param.duplicateMashName != null}"><p class="text-danger">Опрос с данным именем уже существует</p></span>
        <form id="newMashForm" method="post" enctype="multipart/form-data" action="addMash">
            <th:block th:if="${@environment.getProperty('registration.enable')}">
                <div class="form-group">
                    <label for="mashName">Название опроса:</label>
                    <input type="text" class="form-control" id="mashName" name="mashName"
                           th:minlength="${parameters.minMashNameLength}" th:maxlength="${parameters.maxMashNameLength}"
                           required="required"
                           th:attrappend="disabled=${#authorization.expression('isAnonymous()')} ? 'disabled'"/>
                </div>
            </th:block>
            <th:block th:if="${!@environment.getProperty('registration.enable')}">
                <div class="form-group">
                    <label for="mashName">Название опроса:</label>
                    <input type="text" class="form-control" id="mashName" name="mashName"
                           th:minlength="${parameters.minMashNameLength}" th:maxlength="${parameters.maxMashNameLength}"
                           required="required"/>
                </div>
            </th:block>
            <div class="form-group">
                <label for="mashName">Сообщение для респондента:</label>
                <th:block th:if="${@environment.getProperty('registration.enable')}">
                    <input type="text" class="form-control" id="respondentMessage" name="respondentMessage"
                           th:minlength="${parameters.minMashMessage}" th:maxlength="${parameters.maxMashMessage}"
                           required="required"
                           th:attrappend="disabled=${#authorization.expression('isAnonymous()')} ? 'disabled'"/>
                </th:block>
                <th:block th:if="${!@environment.getProperty('registration.enable')}">
                    <input type="text" class="form-control" id="respondentMessage" name="respondentMessage"
                           th:minlength="${parameters.minMashMessage}" th:maxlength="${parameters.maxMashMessage}"
                           required="required"/>
                </th:block>
            </div>
            <div class="form-group">
                <label for="buttonAddFiles">Добавьте изображения</label>
                <th:block th:if="${@environment.getProperty('registration.enable')}">
                    <input type="file" name="files" multiple="multiple" class="form-control-file" id="buttonAddFiles"
                           aria-describedby="emailHelp" accept="image/*"
                           th:picturesMinCount="${parameters.picturesMinCount}"
                           th:picturesMaxCount="${parameters.picturesMaxCount}" required="required"
                           th:attrappend="disabled=${#authorization.expression('isAnonymous()')} ? 'disabled'"/>
                </th:block>
                <th:block th:if="${!@environment.getProperty('registration.enable')}">
                    <input type="file" name="files" multiple="multiple" class="form-control-file" id="buttonAddFiles"
                           aria-describedby="emailHelp" accept="image/*"
                           th:picturesMinCount="${parameters.picturesMinCount}"
                           th:picturesMaxCount="${parameters.picturesMaxCount}" required="required"/>
                </th:block>
                <small id="emailHelp" class="form-text text-muted" th:text="${someVariable}"></small>
            </div>
            <th:block th:if="${@environment.getProperty('registration.enable')}">
                <button type="submit" class="btn btn-primary" id="addMashButton"
                        th:attrappend="disabled=${#authorization.expression('isAnonymous()')} ? 'disabled'">Создать
                    опрос
                </button>
            </th:block>
            <th:block th:if="${!@environment.getProperty('registration.enable')}">
                <button type="submit" class="btn btn-primary" id="addMashButton" > Создать опрос
                </button>
            </th:block>
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        </form>
    </div>
</div>

</body>
</html>